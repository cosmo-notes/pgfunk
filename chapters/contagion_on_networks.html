
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Contagion on networks &#8212; PGFunk</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hypergraphs" href="hypergraphs.html" />
    <link rel="prev" title="Branching process" href="branching_process.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">PGFunk</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  PGF 101
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="pgf_properties.html">
   Definition and properties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="numerical_inversion.html">
   Numerical inversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multivariate_pgf.html">
   Multivariate PGF
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="branching_process.html">
   Branching process
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Contagion on networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hypergraphs.html">
   Percolation on hypergraphs
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Exercises
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="exercise_dice.html">
   Part I: throwing dice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exercise_branching_process.html">
   Part II: branching process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exercise_inference.html">
   Part III: statistical inference
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/gstonge/pgfunk/main?urlpath=lab/tree/chapters/contagion_on_networks.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/gstonge/pgfunk"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/chapters/contagion_on_networks.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#supercritical-contagions">
   Supercritical contagions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sizes-of-subcritical-outbreaks">
   Sizes of subcritical outbreaks
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Contagion on networks</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#supercritical-contagions">
   Supercritical contagions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sizes-of-subcritical-outbreaks">
   Sizes of subcritical outbreaks
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="contagion-on-networks">
<h1>Contagion on networks<a class="headerlink" href="#contagion-on-networks" title="Permalink to this headline">#</a></h1>
<p>We want to look at how something might spread on networks, i.e., a vague <em>contagion</em>. This could be something bad like misinformation among social media users or an infectious disease on a contact network. Or something good like innovations in science. We assume that the thing can spread from one affected node (infectious individual) of the network to any of its neighbors (contacts) independently. The independence is important for now, and means this is a simple <a class="reference external" href="https://en.wikipedia.org/wiki/Global_cascades_model">cascade model</a></p>
<p>Let us assume that the contagion starts on some random patient zero. The network has a certain degree distribution <span class="math notranslate nohighlight">\(p_k\)</span>; i.e., a distribution for the number of contacts of every node. We can then say that the degree of our patient zero is generated by</p>
<div class="math notranslate nohighlight">
\[
G_0(x) = \sum_{k=0}^\infty p_k x^k
\]</div>
<p>The contagion starts on that node but it can only spread to its <span class="math notranslate nohighlight">\(k\)</span> neighbors with some probability <span class="math notranslate nohighlight">\(T\)</span>, call <span class="math notranslate nohighlight">\(T\)</span> a transmission probability. What happens then?</p>
<p>Well, for a single edge (contact or relationship) in the network, the probability generating function of the number of spreading events it causes is as follows</p>
<div class="math notranslate nohighlight">
\[
(1-T)+Tx
\]</div>
<p>since it spreads to its single destination with probability <span class="math notranslate nohighlight">\(T\)</span> and does nothing with probability <span class="math notranslate nohighlight">\(1-T\)</span>. So we are really asking patient zero: How many transmissions will you cause out of your <span class="math notranslate nohighlight">\(k\)</span> edges? This is the sum of <span class="math notranslate nohighlight">\(k\)</span> random variables (which are 0 or 1) and each of them is generated by the transmission PGF above! We know this sum of a random number of random variable is generated by a construction. In this case</p>
<div class="math notranslate nohighlight">
\[
G_0(1-T+Tx)
\]</div>
<p>Building on the previous application, we can assume that the contagion sees the network as a <a class="reference external" href="https://en.wikipedia.org/wiki/Branching_process">branching process</a> speading from neighbor to neighbor. But there is a twist! The neighbors of our patient zero do not have a degree distribution generated from <span class="math notranslate nohighlight">\(G_0(x)\)</span>. Why do we know what? For one thing, they cannot have a degree zero since they are neighbors of patient zero. In fact, by following an edge from patient zero, we are following a random edge and therefore <span class="math notranslate nohighlight">\(k\)</span> times more likely to reach a node of degree <span class="math notranslate nohighlight">\(k\)</span> than a node of degree 1. After all, nodes of high degrees (so-called hubs of the network) are more likely to be neighbors of patient zero than low degree nodes since they have more neighbors. We therefore have to bias the degree distribution to take this network effect into account. The number other neighbors of a random neighbor (meaning, its degree excluding the edge we arrived from) is called the <em>excess degree</em> of a node and is generated by</p>
<div class="math notranslate nohighlight">
\[
G_1(x) \propto \sum_{k=0}^\infty kp_kx^{k-1} = \frac{d}{dx}G_0(x) \equiv G_0'(x)
\]</div>
<p>We use a proportional relationship because the derivative of <span class="math notranslate nohighlight">\(G_0(x)\)</span> at <span class="math notranslate nohighlight">\(x=1\)</span> might not be normalized, which is a key properties of PGFs. We therefore have to do that by hand, resulting in</p>
<div class="math notranslate nohighlight">
\[
G_1(x) = \frac{G_0'(x)}{G_0'(1)}
\]</div>
<p>where the normalization is really the average degree of the network. This means that while the degree of a random node is drawn proportionally to <span class="math notranslate nohighlight">\(p_k\)</span>, the degree <span class="math notranslate nohighlight">\(k\)</span> of a neighbor is drawn proportionally to <span class="math notranslate nohighlight">\(kp_k\)</span> and therefore biased towards higher values. This is called the <a class="reference external" href="https://en.wikipedia.org/wiki/Friendship_paradox">Friendship Paradox</a> and is why your friends have more friends than you do! Here it means that cases caused by patient zero are likely to cause more cases than patient zero. In fact, we now know that the number of transmissions caused by a random neighbor of patient zero will be generated by</p>
<div class="math notranslate nohighlight">
\[
G_1(1-T+Tx)
\]</div>
<section id="supercritical-contagions">
<h2>Supercritical contagions<a class="headerlink" href="#supercritical-contagions" title="Permalink to this headline">#</a></h2>
<p>Using the above, we can now use our previous results! What is the probability of extinction <span class="math notranslate nohighlight">\(u\)</span> downstream from a transmission event? It is the probability that all edges, if any, of the node infected also lead to extinction. This implies the following self-consistent condition:</p>
<div class="math notranslate nohighlight">
\[
u=G_1(1-T+Tu)
\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One important note is that we are here assuming that the other neighbors of the node we reach are independent from one another. E.g., if that node has an excess degree of 2, both of them lead to extinction with probability <span class="math notranslate nohighlight">\((1-T+Tu)^2\)</span>. And that is only true if the network is a tree, or sufficiently locally treelike!</p>
</div>
<p>Using the same logic around patient zero, the probability of extinction requires extinction through all transmissions caused by patient zero. Inversely, the probability that the outbreak <em>never</em> stops is</p>
<div class="math notranslate nohighlight">
\[
1 - G_0(1-T+Tu)
\]</div>
<p>Here is a simple example using a network where <span class="math notranslate nohighlight">\(10\%\)</span> of nodes have degree 1, <span class="math notranslate nohighlight">\(20\%\)</span> have degree 2, <span class="math notranslate nohighlight">\(30\%\)</span> have degree 3, and <span class="math notranslate nohighlight">\(40\%\)</span> have degree 4.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">([</span><span class="s1">&#39;ggplot&#39;</span><span class="p">,</span> <span class="s1">&#39;seaborn-talk&#39;</span><span class="p">])</span>

<span class="n">pk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.4</span><span class="p">]])</span>

<span class="k">def</span> <span class="nf">G0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">T</span><span class="o">*</span><span class="n">x</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">pk</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pk</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">G1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">T</span><span class="o">*</span><span class="n">x</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">pk</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">pk</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pk</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span> <span class="o">/</span> <span class="n">pk</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pk</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">Tlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">usol</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Pext</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">Tlist</span><span class="p">):</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">usol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">usol</span> <span class="k">else</span> <span class="mf">0.5</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">G1</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">pk</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
    <span class="k">while</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">u2</span><span class="o">-</span><span class="n">u1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">G1</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">pk</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
    <span class="n">usol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
    <span class="n">Pext</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">G0</span><span class="p">(</span><span class="n">u2</span><span class="p">,</span><span class="n">pk</span><span class="p">,</span><span class="n">T</span><span class="p">))</span>
<span class="n">Pext</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">Pext</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tlist</span><span class="p">,</span><span class="n">Pext</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">30</span><span class="o">/</span><span class="mi">70</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span> <span class="c1">#critical transmissibility</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Transmission Probability $T$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Epidemic size&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/dl/46h2pcs13c1gj57q8lthvc1c0000gn/T/ipykernel_76764/1409343624.py:3: MatplotlibDeprecationWarning: The seaborn styles shipped by Matplotlib are deprecated since 3.6, as they no longer correspond to the styles shipped by seaborn. However, they will remain available as &#39;seaborn-v0_8-&lt;style&gt;&#39;. Alternatively, directly use the seaborn API instead.
  plt.style.use([&#39;ggplot&#39;, &#39;seaborn-talk&#39;])
</pre></div>
</div>
<img alt="../_images/contagion_on_networks_20_1.png" src="../_images/contagion_on_networks_20_1.png" />
</div>
</div>
<p>You can see a clear transition, or an epidemic threshold, where the probability of extinction starts falling below <span class="math notranslate nohighlight">\(100\%\)</span>. This is when the <a class="reference external" href="https://en.wikipedia.org/wiki/Basic_reproduction_number">Basic Reproduction Number</a> rises above 1. In terms of our PGF, this number <span class="math notranslate nohighlight">\(R_0\)</span> can be calculated as</p>
<div class="math notranslate nohighlight">
\[
R_0 = \frac{d}{dx}G_1(1-T+Tx)\bigg\vert_{x=1}
\]</div>
<p>where again we use the fact that the average of the distribution generated by a PGF is simply its derivative evaluated at 1.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because we assumed an undirected networks, where the contagion can spread in both directions on an edge, then the probability of a supercritical epidemic is the same as the relative size of this epidemic in the network. How can that be? The process used to model the spread is called <a class="reference external" href="https://en.wikipedia.org/wiki/Percolation_theory">bond percolation</a> where every edge exists with fixed probability. What we calculated is the probability that the epidemic does not stop, but it is equivalent to asking about the probability of picking a node that is part of an infinite component in the percolated network (called a <em>giant component</em>). That probability is equal to the size of that infinite component relative to the size of the infinite network! Epidemic probability equals epidemic size (on undirected networks).</p>
</div>
</section>
<section id="sizes-of-subcritical-outbreaks">
<h2>Sizes of subcritical outbreaks<a class="headerlink" href="#sizes-of-subcritical-outbreaks" title="Permalink to this headline">#</a></h2>
<p>Instead of asking about the probability of an outbreak going extinct from a transmission event, let’s adjust our self-consistent condition to ask about the distribution of sizes for outbreaks that go extinct. Let’s say that this unknown distribution of sizes downstream from an edge is generated by <span class="math notranslate nohighlight">\(H_1(x)\)</span>. Then <span class="math notranslate nohighlight">\(H_1(x)\)</span> must be equal to at least one node, the node reached, plus the PGFs of the cumulative sizes of the outbreaks downstream from the excess transmissions of the node reached. This implies the following new self-consistent condition:</p>
<div class="math notranslate nohighlight">
\[
H_1(x) = xG_1(1-T+TH_1(x))
\]</div>
<p>where the <span class="math notranslate nohighlight">\(x\)</span> factors accounts for the node reached, <span class="math notranslate nohighlight">\(G_1(1-T+Tx)\)</span> for its excess transmissions, and <span class="math notranslate nohighlight">\(H_1(x)\)</span> for the components downstream from those transmissions. And knowing <span class="math notranslate nohighlight">\(H_1(x)\)</span> we can calculate the distribution of the size of subcritical outbreaks around patient zero like so</p>
<div class="math notranslate nohighlight">
\[
H_0(x) = xG_0(1-T+TH_1(x))
\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These are also using treelike assumptions! But notice that we only assume a tree structure in small subcritical outbreaks. We are not saying anything about the structure of the network within the supercritical epidemic! Clever.</p>
</div>
<p>We are definitely now calculating probabilities that would be hard to calculate without PGFs!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computes the distribution of the size of subcritical outbreaks.</span>
<span class="k">def</span> <span class="nf">get_outbreak_size_dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">new_H1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">old_H1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="c1"># Solve for H1 by iterating yet again</span>
    <span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">old_H1</span><span class="p">,</span> <span class="n">new_H1</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)):</span>
        <span class="n">old_H1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new_H1</span><span class="p">)</span>
        <span class="n">new_H1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">G1</span><span class="p">(</span><span class="n">old_H1</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="c1"># Computes H0 evaluated at x</span>
    <span class="n">H0_at_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">G0</span><span class="p">(</span><span class="n">new_H1</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
    <span class="c1"># Returns the distribution of the size of small components with the ifft trick</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">H0_at_z</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">T</span> <span class="o">=</span> <span class="mf">0.425</span>

<span class="c1"># Sample of the unit circle.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5000</span>  <span class="c1"># (needs to be large enough to minimize the effect of aliasing)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>

<span class="c1"># Solves the small component size distribution.</span>
<span class="n">CompDist</span> <span class="o">=</span> <span class="n">get_outbreak_size_dist</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">pk</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

<span class="n">Norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CompDist</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">CompDist</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">CompDist</span><span class="o">/</span><span class="n">Norm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Outbreak size&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Fraction of outbreaks&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/contagion_on_networks_32_0.png" src="../_images/contagion_on_networks_32_0.png" />
</div>
</div>
<p>How different is the distribution of outbreak sizes before, around and after the epidemic threshold? Play around with the transmission probability <span class="math notranslate nohighlight">\(T\)</span> in the code snippet above to find out!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Notice that we manually renormalize the calculation of <span class="math notranslate nohighlight">\(H_0(x)\)</span> in order to plot the normalized distribution of subcritical outbreaks. Why? Because <span class="math notranslate nohighlight">\(H_0(x)\)</span> is not actually normalized. There is a missing probability… The probability that the outbreak never goes extinct! That’s right! <span class="math notranslate nohighlight">\(H_0(1)\)</span> is equal to the probability of extinction! The missing probability mass corresponds to supercritical outbreaks and essentially went towards <span class="math notranslate nohighlight">\(x^\infty\)</span>, a term we never get to see. You can therefore use the norm of <span class="math notranslate nohighlight">\(H_0(x)\)</span> to evaluate where you are on the previous figure plotting the probability of extinction.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Probability of extinction = &#39;</span><span class="p">,</span> <span class="n">Norm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Probability of extinction =  0.9999984684581256
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="branching_process.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Branching process</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="hypergraphs.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Hypergraphs</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Antoine Allard, Laurent Hébert-Dufresne, Guillaume St-Onge<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>