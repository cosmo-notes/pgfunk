
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Solving special values &#8212; PGFunk</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/solving_spacial_values';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Inverting probability generating functions" href="numerical_inversion.html" />
    <link rel="prev" title="Probability generating functions" href="pgf_properties.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="PGFunk - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="PGFunk - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">PGF 101</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="pgf_properties.html">Definition and properties</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Solving special values</a></li>
<li class="toctree-l1"><a class="reference internal" href="numerical_inversion.html">Numerical inversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="multivariate_pgf.html">Multivariate PGF</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="branching_process.html">Branching process</a></li>
<li class="toctree-l1"><a class="reference internal" href="cell_mutation.html">Cell mutation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contagion_on_networks.html">Contagion on networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="hypergraphs.html">Percolation on hypergraphs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="exercise_part1.html">Part I: random problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise_branching_process.html">Part II: branching processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise_inference.html">Part III: statistical inference</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/cosmos-books/pgfunk/main?urlpath=lab/tree/chapters/solving_spacial_values.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/cosmos-books/pgfunk" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters/solving_spacial_values.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Solving special values</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#probability-of-extinction">Probability of extinction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#faster-convergence">Faster convergence</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-conditioned-on-extinction">Distribution conditioned on extinction</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="solving-special-values">
<h1>Solving special values<a class="headerlink" href="#solving-special-values" title="Link to this heading">#</a></h1>
<p>While the variable <span class="math notranslate nohighlight">\(x\)</span> of a PGF <span class="math notranslate nohighlight">\(G(x)\)</span> is often meant to simply be interpreted as a counting variable, it can also sometimes be interpreted as a probability.</p>
<section id="probability-of-extinction">
<h2>Probability of extinction<a class="headerlink" href="#probability-of-extinction" title="Link to this heading">#</a></h2>
<p>Consider a simple cell division process: A cell successfully divides in two with probability <span class="math notranslate nohighlight">\(p\)</span>, or dies trying with probability <span class="math notranslate nohighlight">\(1-p\)</span>. Using the definition of PGFs, we can define <span class="math notranslate nohighlight">\(G(x)\)</span> to be the PGF of the count of live cells at the end of the lifetime of a given cell:</p>
<div class="math notranslate nohighlight">
\[
G(x) = (1-p) + px^2 \; .
\]</div>
<p>If <span class="math notranslate nohighlight">\(p=1\)</span>, then obviously the cell population will grow exponentially to infinity. If <span class="math notranslate nohighlight">\(p=0\)</span>, the population dies immediately. What happens in between?</p>
<p>We define <span class="math notranslate nohighlight">\(u\)</span> to be the probability that the descendence of a cell does not grow to an infinite population. For a given cell to not lead to an infinite population, none of their descendents can lead to an infinite population (this is called a <em>self-consistent definition</em>, more on that later).</p>
<p>We can therefore take two perspective. Looking at a given live cell which does not lead to an infinite population must be equivalent to looking at its potential offsprings and requiring that none of them lead to an infinite population. Since these two definitions are equal, we write:</p>
<div class="math notranslate nohighlight">
\[
u = (1-p) +pu^2 = G(u) \; .
\]</div>
<p>Solving for the smallest real positive root of the polynomial <span class="math notranslate nohighlight">\(G(x) - x\)</span> is therefore equivalent to solving for the probability that a population does not live forever. We say the smallest real positive root because the polynomial can have multiple roots and because 1 is always a root (since <span class="math notranslate nohighlight">\(G(x)\)</span> is a PGF such that <span class="math notranslate nohighlight">\(G(1) = 1\)</span>).</p>
<p>Solving for roots of a PGF is actually super easy, barely an inconvenience. We are trying to find where some PGF <span class="math notranslate nohighlight">\(G(x)\)</span> crosses <span class="math notranslate nohighlight">\(x\)</span> (or the diagonal. There are really only two possibilities for how this situation can look:</p>
<p><img alt="PGF-roots" src="../_images/roots.png" /></p>
<p>We know for certain that <span class="math notranslate nohighlight">\(G(x)\)</span> starts at <span class="math notranslate nohighlight">\(G(0)=p_0\geq 0\)</span> and ends at <span class="math notranslate nohighlight">\(G(1) = 1\)</span>. We also know that all of its derivatives are positive (since its coefficients <span class="math notranslate nohighlight">\(p_k \geq 0\)</span> for all <span class="math notranslate nohighlight">\(k\)</span>. Therefore, it either touches the diagonal once before <span class="math notranslate nohighlight">\(G(1) = 1\)</span>, or never. The key distinction between the two scenarios is the derivative <span class="math notranslate nohighlight">\(dG(x)/dx=G'(x)\)</span> at <span class="math notranslate nohighlight">\(x=1\)</span>. If <span class="math notranslate nohighlight">\(G'(1)&gt;1\)</span>, then <span class="math notranslate nohighlight">\(G(x)\)</span> <em>has</em> to touch the diagonal at some value <span class="math notranslate nohighlight">\(0 \leq x &lt; 1\)</span>. That value will be <span class="math notranslate nohighlight">\(x=0\)</span> if <span class="math notranslate nohighlight">\(p_0 = 0\)</span>, or greater than 0 otherwise.</p>
<p>In practice, we want to solve for the exact value of <span class="math notranslate nohighlight">\(u\)</span>; i.e., the crossing of <span class="math notranslate nohighlight">\(G(x)\)</span> and <span class="math notranslate nohighlight">\(x\)</span> where <span class="math notranslate nohighlight">\(G(x)-x=0\)</span>. Luckily, because PGFs are so constrained by the fact that all their coefficients are greater or equal to zero, we can simply iterate the self-consistent definition. We can start at some random value <span class="math notranslate nohighlight">\(x_0&lt;1\)</span> and go to <span class="math notranslate nohighlight">\(x_{n+1} = G(x_n)\)</span> until we converge to withing some satisfactory precision of <span class="math notranslate nohighlight">\(x_{\infty}=u\)</span>. One can inspect the shape of the graph below to understand why that works, and the same logic will hold if we start at <span class="math notranslate nohighlight">\(x_0&lt;u\)</span>:</p>
<p><img alt="PGF-iterations" src="../_images/iteration.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">([</span><span class="s1">&#39;ggplot&#39;</span><span class="p">])</span>

<span class="n">G</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">plist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">usol</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Pext</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">plist</span><span class="p">):</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">usol</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">usol</span> <span class="k">else</span> <span class="mf">0.5</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">u1</span><span class="p">)</span>
    <span class="k">while</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">u2</span><span class="o">-</span><span class="n">u1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">u1</span><span class="p">)</span>
    <span class="n">usol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
    <span class="n">Pext</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
<span class="n">Pext</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">Pext</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span><span class="n">Pext</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$p$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Probability of extinction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a504b4799c2ba39db7277c23f4a02810d72b3b77373ba5c37ddb7c477442de6e.png" src="../_images/a504b4799c2ba39db7277c23f4a02810d72b3b77373ba5c37ddb7c477442de6e.png" />
</div>
</div>
</section>
<section id="faster-convergence">
<h2>Faster convergence<a class="headerlink" href="#faster-convergence" title="Link to this heading">#</a></h2>
<p>In the code above, we keep track of our current estimate for <span class="math notranslate nohighlight">\(u\)</span> which we call <span class="math notranslate nohighlight">\(u_1\)</span> and update it to <span class="math notranslate nohighlight">\(u_2 = G(u_1)\)</span> until <span class="math notranslate nohighlight">\(\vert u2-u1\vert &gt; 10^{-5}\)</span>. We do use one easy trick to speed up the convergence though: Since we are going through values of the parameter <span class="math notranslate nohighlight">\(p\)</span> consecutively, we start our iteration at a <span class="math notranslate nohighlight">\(u_1\)</span> value that corresponds to the previous converged value (or 0.5 if this is the first value we test). Since we expect that the exact value of <span class="math notranslate nohighlight">\(u\)</span> must vary continuously with <span class="math notranslate nohighlight">\(p\)</span>, starting the iterative process for <span class="math notranslate nohighlight">\(p\)</span> at the solution for <span class="math notranslate nohighlight">\(p'\)</span> means that we are starting close to the new solution.</p>
<p>We can achieve even faster convergence.</p>
<p>To find the zero of a continuous function, one incredibly simple idea known as <a class="reference external" href="https://en.wikipedia.org/wiki/Newton%27s_method">Newton’s method</a> is to assume that the function is linear. Given some current estimate <span class="math notranslate nohighlight">\(x_n\)</span>, we track the slope until we reach zero and call this our new estimate <span class="math notranslate nohighlight">\(x_{n+1}\)</span>. We then repeat until convergence. Since the slope can be approximated as the change in value over the change in <span class="math notranslate nohighlight">\(x\)</span>, we can derive an easy relationship between <span class="math notranslate nohighlight">\(x_n\)</span>, <span class="math notranslate nohighlight">\(x_{n+1}\)</span> and the slope.</p>
<div class="math notranslate nohighlight">
\[
\frac{d}{dx} \left[G(x) - x\right]\big\vert_{x=x_n} = G'(x_n)-1 = \frac{G(x_n)-x_n-0}{x_n-x_{n+1}} \rightarrow x_{n+1} = x_n - \frac{G(x_n)-x_n}{G'(x_n) - 1}
\]</div>
<p>which can be understood visually as follows.</p>
<p><img alt="Newton-method" src="../_images/newton.png" /></p>
<p>If we do not want to have to evaluate both <span class="math notranslate nohighlight">\(G(x)\)</span> and its derivative <span class="math notranslate nohighlight">\(G'(x_n)\)</span>, we can also rely on a simple approximation of the slope. The approach is then known as <a class="reference external" href="https://en.wikipedia.org/wiki/Steffensen%27s_method">Steffensen’s method</a>. The approximation goes as follows:</p>
<div class="math notranslate nohighlight">
\[
f'(x) \approx g(x) = \frac{f(x+f(x))}{f(x)} - 1 \; .
\]</div>
<p>Which in the case of the function we care about, <span class="math notranslate nohighlight">\(f(x) = G(x)-x\)</span>, becomes
$<span class="math notranslate nohighlight">\(
G'(x_n)-1 \approx \frac{G(G(x_n))-2G(x_n)+x_n}{G(x_n)-x_n}
\)</span>$</p>
<p>This approach can be impletemented as follows and compared to the previous ‘direct’ approach. While it is <em>much</em> faster, the code is a little less neat: We have to evaluate the PGF a lot and test that the slope isn’t too close to zero to avoid numerical issues. While in practice we might often use Steffensen’s method, we use the direct approach in much of this sourcebook in the spirit of code readability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Direct iteration</span>
<span class="n">G</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">u1</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">u2</span> <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">u1</span><span class="p">)</span>
<span class="n">iter_direct</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">u2</span><span class="o">-</span><span class="n">u1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">):</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">u2</span>
    <span class="n">u2</span> <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">u1</span><span class="p">)</span>
    <span class="n">iter_direct</span><span class="o">+=</span><span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Direct iteration took &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iter_direct</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; iterations to find u = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Direct iteration took 139 iterations to find u = 0.6666666666666634
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Steffensen&#39;s method</span>
<span class="n">G</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="n">p</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">u1</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">u2</span> <span class="o">=</span> <span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">u1</span><span class="p">)</span>
<span class="n">iter_steffensen</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span>  <span class="nb">abs</span><span class="p">(</span><span class="n">u2</span><span class="o">-</span><span class="n">u1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">):</span>
    <span class="n">u1</span> <span class="o">=</span> <span class="n">u2</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">u1</span><span class="p">))</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">u1</span><span class="p">)</span><span class="o">+</span><span class="n">u1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">u1</span><span class="p">)</span><span class="o">-</span><span class="n">u1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">):</span> <span class="c1">#otherwise we can have numerical issue when very close</span>
        <span class="n">u2</span><span class="o">=</span><span class="n">u1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">u1</span><span class="o">-</span><span class="p">(</span><span class="n">G</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">u1</span><span class="p">)</span><span class="o">-</span><span class="n">u1</span><span class="p">)</span><span class="o">/</span><span class="n">denominator</span>
    <span class="n">iter_steffensen</span><span class="o">+=</span><span class="mi">1</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Steffensen took &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iter_steffensen</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; iterations to find u = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">u2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Steffensen took 7 iterations to find u = 0.6666666666666679
</pre></div>
</div>
</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>There are other methods for convergence, such as <a class="reference external" href="https://en.wikipedia.org/wiki/Aitken%27s_delta-squared_process">Aitken’s delta-squared process or Aitken extrapolation</a>. But the authors have found the method described here to be preferred in most situations.</p>
</div>
</section>
<section id="distribution-conditioned-on-extinction">
<h2>Distribution conditioned on extinction<a class="headerlink" href="#distribution-conditioned-on-extinction" title="Link to this heading">#</a></h2>
<p>Even when random events are independent realizations of a stochastic process with known parameters, they can become correlated or their observed parameters might change once we condition on their outcome. Here is a simple example, say that we flip an unbiased coin such that (a priori) we get ‘tails’ 50% of the time, and keep flipping until we get ‘heads’ then stop. Conditioned on a total sequence being of length two, the first flip is now 100% tails and the second flip is now 100% heads, not the 50/50 split expected before the flip.</p>
<p>What does this mean for our cell division example? Given a probability of successful cell division <span class="math notranslate nohighlight">\(p\)</span>, we now know how to calculate the probability of extinction <span class="math notranslate nohighlight">\(u\)</span>. If we are interested in specifically studying the dynamics of cell lineage that go extinct, what is the effective probability of successful cell division <span class="math notranslate nohighlight">\(p'\)</span> that govern their dynamics?</p>
<p>Looking at the first cell in the now extinct lineage, we know that it can fail to divide, or that if it does divide, none of their descendents can lead to an infinite population. The cell therefore divides according to the following generating function</p>
<div class="math notranslate nohighlight">
\[
G'(x) \propto (1-p)+pu^2 x^2
\]</div>
<p>and normalizing to get a proper PGF</p>
<div class="math notranslate nohighlight">
\[
G'(x) = \frac{(1-p)+pu^2 x^2}{G(u)} = \frac{1}{u}G(ux) \; .
\]</div>
<p>Say the true dynamics of the cells actually lead to a probability of succesfull division of <span class="math notranslate nohighlight">\(p=0.6\)</span>. We saw that a population of cells therefore has a probability of <span class="math notranslate nohighlight">\(u=0.666\)</span> of going extinct. This means that when looking at the dynamics of lineages that do go extinct, the effective probability of succesful division is only <span class="math notranslate nohighlight">\(p' = pu^2 = 0.266\)</span>.</p>
<p>What does this mean? Even though the first cell is more likely to divide then die, when looking at finite populations of cells that went extinct, the vast of these will have gone extinct with their first cell not dividing. Stochastic processes are not always intuitive!</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="pgf_properties.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Probability generating functions</p>
      </div>
    </a>
    <a class="right-next"
       href="numerical_inversion.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Inverting probability generating functions</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#probability-of-extinction">Probability of extinction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#faster-convergence">Faster convergence</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-conditioned-on-extinction">Distribution conditioned on extinction</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Antoine Allard, Laurent Hébert-Dufresne, Guillaume St-Onge
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>